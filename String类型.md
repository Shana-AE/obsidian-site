# [[String类型|String类型]]

-   String 比那些基础标量数据类型更复杂
-   字符串字面值：程序里手写的那些字符串值。它们是不可变的
-   Rust 还有第二种字符串类型：String
    -   在heap 上分配。能够存储在编译时未知数量的文本

## 创建String类型的值

-   可以使用 from 函数从字符串字面值创建出 String 类型
-   `let s = String:from("hello");`
    -   `::`表示 from是 String 类型下的函数
-   这类字符串是可以被修改的

```rust
fn main() {
	let mut s = String::from("Hello");
	s.push_str(", World");
	println!("{}", s);
}
```

-   为什么 String类型的值可以修改，而字符串字面值却不能修改？
    -   因为它们处理内存的方式不同

## 内存和分配

-   字符串字面值，在编译时就知道它的内容了，其文本内容直接被硬编码到最终的可执行文件里
    -   速度快、高效。是因为其不可变性
-   String 类型，为了支持可变性，需要在 heap 上分配内存来保存编译时未知的文本内容：
    -   操作系统必须在运行时来请求内存
        -   这步通过调用String::from来实现
    -   当用完 String之后，需要使用某种方式将内存返回给操作系统
        -   这步，在拥有 GC的语言中，GC会跟踪并清理不再使用的内存
        -   没有GC，就需要我们去识别内存何时不再使用，并调用代码将它返回
            -   如果忘了，那就浪费内存
            -   如果提前做了，变量就会非法
            -   如果做了两次，也是Bug。必须一次分配对应一次释放
-   Rust采用了不同的方式：对于某个值来说，当拥有它的变量走出作用范围时，内存会立即自动的交还给操作系统。

```rust
fn main() {
	let mut s = String::from("Hello");
	s.push_str(", World");
	println!("",s);
} // s走出scope，自动调用drop函数
```

-   drop 函数